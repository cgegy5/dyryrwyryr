\documentclass{report}
\usepackage[utf8]{inputenc}     % for éô
\usepackage[english]{babel}     % for proper word breaking at line ends
\usepackage[a4paper, left=1.5in, right=1.5in, top=1.5in, bottom=1.5in]{geometry}
                                % for page size and margin settings
\usepackage{imakeidx}           % for creating a look-up index
\usepackage{natbib}
\bibliographystyle{humannat}
\usepackage{graphicx}           % for image widths

%\graphicspath{{img/}{../img/}}
\usepackage{subfiles}

\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage[european,siunitx]{circuitikz}
\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{calc}
\usepackage{adjustbox}
\usepackage[labelfont=bf]{caption}
\usepackage{subcaption}
\usepackage{amsmath,amssymb}    % for better equations
\usepackage{amsthm}             % for better theorem styles
\usepackage{mathtools}          % for greek math symbol formatting
\usepackage{enumitem}           % for control of 'enumerate' numbering
\usepackage{listings}           % for control of 'itemize' spacing
%\usepackage[obeyDraft]{todonotes}
                                % for clear TODO notes
\usepackage{todonotes}          % for clear TODO notes
% \usepackage{multicol}         % for creating a 2-column document
\usepackage[hidelinks]{hyperref}% page numbers and '\ref's become clickable
% \usepackage{mathabx}          % astro
\usepackage{fourier-orns}       % leaf symbol
\usepackage{marvosym}           % lightning symbol
\usepackage{siunitx}            % for writing physical units like \si{\micro\ohm\per\meter}
\usepackage{textcomp}
\usepackage{eurosym}
\DeclareSIUnit\EUR{\text{\euro}}
%\usepackage[parfill]{parskip}
\usepackage{empheq}
\setlength{\fboxsep}{1em}
\usepackage[normalem]{ulem}     % for strikethrough text
\usepackage{booktabs}
\usepackage{tabularx}
\renewcommand{\arraystretch}{1.2}
\usepackage{bold-extra}
\usepackage{bm}
\usepackage{upgreek}
\usepackage{dsfont}

\usepackage{newfloat}
\DeclareFloatingEnvironment[name={Interactive Figure}]{ifigure}

% Font choice

\usepackage{comment}


%\newcommand{\mat}[1]{\ensuremath{\boldsymbol{\mathrm{#1}}}}
\newcommand{\mat}[1]{\ensuremath{\bm{\mathrm{#1}}}}

%\begin{comment}
\usepackage[T1]{fontenc}
\usepackage[boldsans]{ccfonts}

\renewcommand{\bfseries}{\fontfamily{bch}\fontseries{bx}\selectfont}
% \DeclareMathAlphabet{\mathbf} {OT1}{\mathsf}{bx}{n}
\DeclareMathAlphabet{\mathbf} {OT1}{bch}{bx}{n}


\pdfpkmode{dpdfezzz}
\pdfpkresolution=1200


\usepackage[pagestyles, clearempty]{titlesec}%
\usepackage{fmtcount,etoolbox}

%\begin{comment}
\titleformat{\chapter}[display]{\center}
{%\titlerule\vspace{1.4em}
\Large\it\chaptername{ }\numberstring{chapter}}
%{1\baselineskip}
{0pt}
{\Huge}
[]

\titlespacing*{\chapter}
    {0pt}% left
    {1cm}% before
    {2em}% after

\titleformat{\part}[display]
{\centering\normalfont\huge}
{\partname{ }\thepart}
{0pt}
{\vspace{1em}\Huge}
[]

\titlespacing*{\part}{0pt}{8cm}{0pt}


%\renewcommand{\mat}[1]{\ensuremath{\mathbf{#1}}}
%\newcommand{\matSigma}{\Sigma}
%\end{comment}

\makeatletter
\renewcommand{\mat}[1]{
\StrLeft{#1}{1}[\chrfirst]
\IfSubStr{ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}{\chrfirst}
   {\mathbf{#1}}
   {\bm{#1}}
}
\makeatother


%% DOCUMENT
\def\thesistitle{Power Grid Failures}
\def\thesissubtitle{Theory of Fluctuating Renewables}
\def\thesisauthorfirst{Fons}
\def\thesisauthorsecond{van der Plas}
\def\thesissupervisorfirst{dr. Henk}
\def\thesissupervisorsecond{Don}
\def\thesissecondreaderfirst{prof. dr. Eric}
\def\thesissecondreadersecond{Cator}
\def\thesisdate{July 2019}

%% FOR PDF METADATA
\title{\thesistitle}
\author{\thesisauthorfirst\space\thesisauthorsecond}
\date{\thesisdate}


%% TODO PACKAGE
\newcommand{\towrite}[1]{\todo[inline,color=yellow!10]{#1}}
\newcommand{\tocite}[1]{\todo[color=green!10]{#1}}
\newcommand{\todelete}[1]{\sout{#1}}

%% INDEX
\makeindex

%% THEOREM STYLES
\renewcommand\qedsymbol{\leafNE}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{examplex}[theorem]{Example}
\newenvironment{example}
  {\renewcommand{\qedsymbol}{\textthing}%
   \pushQED{\qed}\begin{examplex}}
  {\popQED\end{examplex}}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem*{intuition}{Intuitive argument}

%% MATH STYLES
%\newcommand{\mat}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\mel}[1]{\ensuremath{{\mathrm{#1}}}}
\newcommand{\phym}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\range}[1]{\ensuremath{[#1]}}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\abs}[1]{\left\lvert#1\right\rvert}
\newcommand{\defeq}[0]{:=}
\newcommand{\LPF}[0]{\ensuremath{\text{\textup{LPF}}}}
% \newcommand{\FRT}[0]{\ensuremath{\text{\textup{FRT}}}}
\newcommand{\FRT}[0]{\ensuremath{\text{\textup{K}}}}

%% MATH OPERATORS
\newcommand{\conj}[1]{\overline{#1}}
\newcommand{\pointwise}{\ast}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\Arg}{Arg}
\DeclareMathOperator{\Ima}{Im}
\DeclareMathOperator{\linspan}{Span}
\DeclareMathOperator{\gr}{gr}
\DeclareMathOperator{\nullity}{null}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\PROB}{\mathbb{P}}
\DeclareMathOperator{\EXP}{\mathbb{E}}
\DeclareMathOperator{\COVMAT}{\mathcal{C}}
\DeclareMathOperator{\gaussdistr}{\mathcal{N}}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator{\sign}{sign}

%% MISC
\newcommand{\define}[1]{\emph{#1}\index{#1}}
\newcommand{\ie}{i.e.\ }
\newcommand{\eg}{e.g.\ }
\newcommand{\almosteverywhere}{a.e.\ }

\setlength{\parindent}{0pt}
\setlength{\parskip}{.5em}

% https://tex.stackexchange.com/a/63549
\makeatletter
\def\oversortoftilde#1{\mathop{\vbox{\m@th\ialign{##\crcr\noalign{\kern3\p@}%
      \sortoftildefill\crcr\noalign{\kern3\p@\nointerlineskip}%
      $\hfil\displaystyle{#1}\hfil$\crcr}}}\limits}

\def\sortoftildefill{$\m@th \setbox\z@\hbox{$\braceld$}%
  \braceld\leaders\vrule \@height\ht\z@ \@depth\z@\hfill\braceru$}

\makeatother

\DeclareRobustCommand\inlineres{\raisebox{-.3mm}{\begin{circuitikz}\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[R] (1,0);\end{circuitikz}}}
\DeclareRobustCommand\inlineac{\raisebox{-1.4mm}{\begin{circuitikz}\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[sV] (1,0);\end{circuitikz}}}


\input{fig/inlinebars.tex}

%%%%%%%%%%%%%%%%%%%%%%%






\begin{document}
\pagenumbering{roman}

%\begin{multicols}{2}
\input{titlepage.tex}

\chapter*{Summary}
\vspace{1cm}
Limiting global warming requires a rapid transition towards renewable generation of electric energy. For this purpose, global energy demand becomes increasingly dependent on solar and wind energy. Unlike conventional energy sources, these stochastic sources inject a fluctuating amount of power into the electric grid. Large-scale fluctuations change the electric current through high-voltage lines of the transmission network, possibly evoking a line overload. Moreover, the failure of one line can result in a cascade of other failures, eventually causing a blackout. 

In this thesis, we will study the effect of fluctuating renewables on the robustness of electric power transmission. To this end, we develop a mathematical framework that models the transmission of stochastic generation and predicts the line failure probability. The model accounts for correlated fluctuations among different network buses, which arise from correlated weather. The model extends the classical DC approximation to the stochastic case and uses algebraic graph theory to study the flow redistribution after multiple line outages.

Inspired by a recent study \citep{Nesti2018emergentfailures}, we demonstrate the applicability of this theory by identifying the most vulnerable lines in the German transmission network, and simulating the resulting cascades. This case study illustrates the usefulness and limitations of our model to predict line failures caused by fluctuating renewables. Using such methods in practice helps us to evaluate the risks of stochastic generation more precisely, allowing for higher shares of renewable generation to be installed.

%
%\towrite{
%By studying the effect of fluctuating renewables, we can better estimate which transmission lines are vulnerable to these emergent failures. The theory discussed in this thesis can be used to 
%
%The aim of this bachelor thesis is to introduce the reader to the fascinating mathematics that are used to model the effect of \emph{fluctuating renewables}. 
%
%Emergent failures can be prevented 
%
%The transmission network is 
%
%At the end of Part I, we extend our model to \emph{correlated, normally distributed generation}. 
%
%In Part II, we demonstrate how the theory developed in Part I can be used to 
%
%These procedures are applied to the SciGRID network: a digital representation of the German high-voltage transmission network (489 buses, 695 lines). We use the work of \cite{PyPSA} and  to estimate hourly load and generation series during the year 2011 for each bus. 
%
%Following \cite{Nesti2018emergentfailures}, we estimate the covariances in (renewable) generation between buses, and we use linearised power flow physics to find a \emph{multivariate Gaussian distribution of line flows}. This allows us to identify lines with the highest probability of overloading.
%
%Additionally, for each vulnerable line we can compute the \emph{most likely fluctuation} that would cause its emergent failure. 
%When a transmission line fails, power flow is instantly redistributed among other lines in the network, which might cause them to also overload.
%By estimating the most likely fluctuation, we can simulate these \emph{cascading failures} more realistically, to assess the damage that an emergent failure would cause.
%
%The model that we 
%
%To 
%
%In Part I, we cover the mathematical theory (graph theory and probability theory) 
%
%This bachelor thesis was written as a }

\chapter*{Notation}
\begin{align*}
\mat{Y}&\text{ is a matrix or vector} \\
\mel{Y}_{i,j}& \text{ is an element of a matrix or vector} \\
Y&\text{ is a (real or complex) number}\\
\phym{Y}&\text{ is a physical quantity (like `admittance')}\\
\conj{\mat{Y}}&\text{ is the \emph{element-wise complex conjugate} of $\mat{Y}$} \\
\mat{Y}^*&\text{ is the \emph{adjoint} of $\mat{Y}$ (which is equivalent to}\\
        &\quad \text{ the \emph{transpose} for real-valued $\mat{Y}$)} \\
\range{n}&=\{1,\dots,n\} \\
\text{\textthing}&\text{\emph{ end of example}} \\
\text{\leafNE}&\text{\emph{ end of proof}}
\end{align*}
%\towrite{Een geel doosje geeft aan dat een stuk tekst \emph{nog geschreven moet worden}.}
%\todo{Een oranje doosje is meer \emph{voor mezelf}, dingen waar ik later nog naar moet kijken.}
%\tocite{Een groen doosje geeft \emph{bronnen} aan die relevant (kunnen) zijn.}

\setcounter{tocdepth}{1}
\tableofcontents

\clearpage
\pagenumbering{arabic}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\part{Theory of Electric Power Networks}\label{part:theory}


\chapter{Graph theory}\label{chap:graphtheory}
\vspace{-2em}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[R] (15,0);\end{circuitikz}
\vspace{.5em}
\subfile{graph}

%\chapter*{Circuit Theory}\label{chap:circuittheory}
%\vspace{-2em}
%\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to (15,0);\end{circuitikz}
%\vspace{1em}
%\subfile{circuit}
%
\chapter{Probability Theory}\label{chap:probtheory}
\vspace{-2em}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[C] (15,0);\end{circuitikz}
\vspace{1em}
\subfile{probability}

\chapter{The Electric Grid}\label{chap:grid}
\vspace{-2em}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[sV] (15,0);\end{circuitikz}
\vspace{1em}
\subfile{grid}

\chapter{Modelling Transmission Networks}\label{chap:model}
\vspace{-2em}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[cute inductor] (15,0);\end{circuitikz}
\vspace{1em}
\subfile{model}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\part{Predicting failures in Germany's grid}\label{part:sim}

\chapter{Methods}\label{chap:methods}
\vspace{-2em}
%\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}
%\draw[] (7.5,0) node[npn, rotate=90] (thenpn) {};
%\draw[] (0,0) to (thenpn.C);
%\draw[] (thenpn.E) to (15,0);
%\end{circuitikz}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}
\ctikzset{bipoles/cuteswitch/thickness=0.5}
\draw[] (0,0) to[cute open switch] (15,0);
\end{circuitikz}
\vspace{1em}

\subfile{methods}

\chapter{Results}\label{chap:results}
\vspace{-2em}
\begin{circuitikz}[scale=\textwidth/15cm]\ctikzset{bipoles/length=7mm}\draw[] (0,0) to[fuse] (15,0);\end{circuitikz}
\vspace{1em}
\subfile{results}

\appendix
\chapter*{From the author}
Thank you for reading my bachelor thesis! I hope that I have been able to express my enthusiasm and fascination for the subject. It has been a wonderful experience to work on this thesis, and I am especially proud to have worked on a problem that is the subject of current research.

I would like to thank my supervisors, Henk and Eric, for taking the time to guide me through this process, for communicating their knowledge and for supporting my unusual choice of subject.

I have been fortunate enough to speak with Tommasso Nesti and Bert Zwart, who, together with Alessandro Zocca, authored the article that this thesis was inspired by. Their comments helped me to better understand the context and interpretation of their model. 
I also wish to thank Uli Zeitler for discussing the physical properties of AC transmission lines and Klaas Landsman for helping me find the right thesis subject.
\\[2em]
I am very grateful to my family and friends for the wonderful four years in {Nijmegen}. I would like to thank my friend Merlijn Kersten for his enthusiasm and advice during the past few months, and I thank my brother Thijs van der Plas for giving me a pair of shoulders to stand on.
\\[3em]
\begin{flushright}
\emph{-fons}
\end{flushright}

%\chapter*{Software}
%\vspace{1em}
%\emph{This thesis would not have been possible without the (mostly open source) projects listed in this section. }
%\begin{itemize}
%\item 
%\end{itemize}

%Contributions:
%\begin{itemize}
%\item Together with Fabian Hofmann and the original authors, I have modified PyPSA's plotting method to allow for a custom geographical projection. (Transverse Mercator with centre )
%\item A minimal version of this document . The title page is based on the work of Tom Salet.
%\item 
%\end{itemize}
%

\bibliography{library}
\vspace{8em}
{The code used to generate this document (\LaTeX) and the embedded figures (\texttt{Python 3.7} with \texttt{numpy} and \texttt{matplotlib}) is available\footnote{open source, under the MIT Licence} at the \emph{GitHub repository}:}\\[1em]
\hphantom{asdfsdzz}\href{https://github.com/fonsp/grid-analysis}{\texttt{github.com/fonsp/grid-analysis}}\\[2em]

{The Interactive Figure contains its own source code (\texttt{JS} with \texttt{D3.js}):}\\[1em]
\hphantom{asdfsdzz}\href{https://fonsp.com/grid}{\texttt{fonsp.com/grid}}\\[2em]

{If you have any comments, I would love to hear from you!}\\[1em]
\hphantom{asdfsdzz}\href{mailto:fonsvdplas@gmail.com}{\texttt{fonsvdplas@gmail.com}}\\[2em]

%\printindex
\end{document}
